system:
  mode: BUILD
  owner: Paul
  description: "Bootstrap phase â€“ governance incomplete"
  started_at: 2025-01-02

modes:
  BUILD:
    description: "Bootstrap phase - governance being constructed"
    allows:
      - limited_bypass
      - schema_iteration
      - rule_modification
    requires:
      - override_record
      - commit_prefix: "[BUILD_MODE]"
      - owner_present: true
    restrictions:
      - no_production_data
      - no_external_access
      - audit_all_actions
    exit_criteria:
      - all_schemas_locked
      - sentinel_passing
      - codex_rules_complete
      - human_review_complete

  OPERATE:
    description: "Normal operation - full governance enforced"
    allows:
      - normal_operations
    requires:
      - all_gates_active
      - sentinel_healthy
      - no_active_p0
    restrictions:
      - no_bypass
      - no_schema_changes
      - no_rule_changes
    exit_criteria:
      - never  # Cannot exit OPERATE without MAINTENANCE

  MAINTENANCE:
    description: "Scheduled maintenance window"
    allows:
      - schema_updates
      - rule_updates
      - system_upgrades
    requires:
      - scheduled_window
      - owner_approval
      - backup_verified
    restrictions:
      - time_limited: 4h
      - audit_all_actions
    exit_criteria:
      - maintenance_complete
      - all_tests_pass

  LOCKDOWN:
    description: "Security incident - all operations halted"
    allows:
      - read_only_access
      - audit_review
    requires:
      - incident_declared
      - owner_present
    restrictions:
      - no_writes
      - no_deletes
      - no_external
    exit_criteria:
      - incident_resolved
      - owner_approval
      - security_review_complete

transitions:
  BUILD_to_OPERATE:
    requires:
      - all_exit_criteria_met
      - owner_approval
      - final_backup_complete
    actions:
      - lock_all_schemas
      - enable_all_gates
      - notify_owner

  OPERATE_to_MAINTENANCE:
    requires:
      - scheduled_window
      - owner_approval
      - backup_verified
    actions:
      - pause_non_critical
      - enable_maintenance_mode

  OPERATE_to_LOCKDOWN:
    requires:
      - p0_alert OR owner_trigger
    actions:
      - halt_all_operations
      - preserve_state
      - notify_owner

  any_to_BUILD:
    requires:
      - owner_approval
      - documented_reason
    actions:
      - tag_as_rebuild
      - preserve_audit_trail
