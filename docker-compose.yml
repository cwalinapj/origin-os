services:
  # ==========================================================================
  # FIGMA MCP — Design Integration
  # ==========================================================================
  figma:
    build: ./services/figma-mcp
    container_name: origin-figma
    ports:
      - "8010:8000"
    environment:
      - FIGMA_API_KEY=${FIGMA_API_KEY}
      - VAULT_URL=http://vault:8000
      - CODEX_URL=http://codex:8000
    volumes:
      - figma-data:/data/figma
    depends_on:
      - vault
      - codex
    restart: unless-stopped

  # ==========================================================================
  # VERCEL MCP — Deployment Integration
  # ==========================================================================
  vercel:
    build: ./services/vercel-mcp
    container_name: origin-vercel
    ports:
      - "8011:8000"
    environment:
      - VERCEL_TOKEN=${VERCEL_TOKEN}
      - VERCEL_TEAM_ID=${VERCEL_TEAM_ID:-}
      - VAULT_URL=http://vault:8000
      - CODEX_URL=http://codex:8000
    volumes:
      - vercel-data:/data/vercel
    depends_on:
      - vault
      - codex
    restart: unless-stopped

  # ==========================================================================
  # AUTO-CLAUDE — Primary AI Coding Agent
  # ==========================================================================
  auto-claude:
    build: ./services/auto-claude
    container_name: origin-auto-claude
    ports:
      - "8000:8000"
    environment:
      - LLM_PROVIDER=${LLM_PROVIDER:-claude}
      - ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY}
      - CLAUDE_MODEL=${CLAUDE_MODEL:-claude-sonnet-4-20250514}
      - OPENAI_API_KEY=${OPENAI_API_KEY}
      - OPENAI_MODEL=${OPENAI_MODEL:-gpt-4o}
      - OPENROUTER_API_KEY=${OPENROUTER_API_KEY}
      - GRAPHITI_ENABLED=true
      - FALKORDB_URL=redis://falkordb:6379
      - CODEX_URL=http://codex:8000
      - VAULT_URL=http://vault:8000
      - MEMORY_URL=http://memory:8000
      - MCP_HUB_URL=http://mcp-hub:8000
      - FIGMA_URL=http://figma:8000
      - VERCEL_URL=http://vercel:8000
      - GITHUB_TOKEN=${GITHUB_TOKEN}
    volumes:
      - auto-claude-data:/data/auto-claude
      - auto-claude-worktrees:/data/worktrees
      - ${PROJECTS_DIR:-/Users/root1/projects}:/projects:rw
      - system-state:/system:ro
    depends_on:
      - codex
      - vault
      - memory
      - figma
      - vercel
      - falkordb
    restart: unless-stopped

  # ==========================================================================
  # CORE SERVICES
  # ==========================================================================
  ui:
    build: ./services/ui
    container_name: origin-ui
    ports:
      - "8080:8000"
    environment:
      - OPENROUTER_API_KEY=${OPENROUTER_API_KEY}
      - CODEX_URL=http://codex:8000
      - MCP_HUB_URL=http://mcp-hub:8000
      - FIGMA_URL=http://figma:8000
      - VERCEL_URL=http://vercel:8000
    depends_on:
      - codex
      - mcp-hub
      - figma
      - vercel
    restart: unless-stopped

  codex:
    build: ./services/codex
    container_name: origin-codex
    ports:
      - "8001:8000"
    environment:
      - JWT_SECRET=${JWT_SECRET}
      - REQUIRE_AUTH=true
      - SENTINEL_ALERTS_DIR=/vault/sentinel/alerts
    volumes:
      - sentinel-alerts:/vault/sentinel/alerts:ro
      - codex-rules:/codex/rules:ro
      - system-state:/system:ro
    restart: unless-stopped

  mcp-hub:
    build: ./services/mcp-hub
    container_name: origin-mcp-hub
    ports:
      - "8002:8000"
    environment:
      - JWT_SECRET=${JWT_SECRET}
      - CODEX_URL=http://codex:8000
      - VAULT_URL=http://vault:8000
      - MEMORY_URL=http://memory:8000
      - AUTO_CLAUDE_URL=http://auto-claude:8000
      - FIGMA_URL=http://figma:8000
      - VERCEL_URL=http://vercel:8000
      - OPENROUTER_API_KEY=${OPENROUTER_API_KEY}
      - OPENAI_API_KEY=${OPENAI_API_KEY}
      - ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY}
      - GITHUB_TOKEN=${GITHUB_TOKEN}
    volumes:
      - mcp-data:/data
    depends_on:
      - codex
      - vault
      - memory
      - figma
      - vercel
    restart: unless-stopped

  vault:
    build: ./services/vault
    container_name: origin-vault
    ports:
      - "8004:8000"
    environment:
      - VAULT_MASTER_KEY=${JWT_SECRET}
      - VAULT_DIR=/vault
    volumes:
      - vault-data:/vault
      - sentinel-alerts:/vault/sentinel/alerts:rw
      - codex-audit:/vault/codex/audit:rw
    restart: unless-stopped

  memory:
    build: ./services/memory-s3
    container_name: origin-memory
    ports:
      - "8007:8000"
    environment:
      - EBS_DATA_DIR=/data/memory
      - B2_ENABLED=${B2_ENABLED:-true}
      - B2_KEY_ID=${B2_KEY_ID}
      - B2_APP_KEY=${B2_APP_KEY}
      - B2_BUCKET_NAME=${B2_MEMORY_BUCKET:-origin-os-memory}
      - OPENROUTER_API_KEY=${OPENROUTER_API_KEY}
      - OPENAI_API_KEY=${OPENAI_API_KEY}
    volumes:
      - memory-data:/data/memory
    restart: unless-stopped

  orchestrator:
    build: ./services/orchestrator
    container_name: origin-orchestrator
    ports:
      - "8005:8000"
    environment:
      - MCP_HUB_URL=http://mcp-hub:8000
      - CODEX_URL=http://codex:8000
      - VAULT_URL=http://vault:8000
      - MEMORY_URL=http://memory:8000
      - AUTO_CLAUDE_URL=http://auto-claude:8000
      - FIGMA_URL=http://figma:8000
      - VERCEL_URL=http://vercel:8000
    volumes:
      - orchestrator-data:/data/orchestrator
    depends_on:
      - mcp-hub
      - vault
      - figma
      - vercel
    restart: unless-stopped

  backup:
    build: ./services/backup
    container_name: origin-backup
    ports:
      - "8006:8000"
    environment:
      - BACKUP_DIR=/backups
      - B2_KEY_ID=${B2_KEY_ID:-}
      - B2_APP_KEY=${B2_APP_KEY:-}
      - B2_BUCKET_NAME=${B2_BUCKET_NAME:-}
    volumes:
      - backup-data:/backups
      - /var/run/docker.sock:/var/run/docker.sock
    restart: unless-stopped

  sentinel:
    build: ./services/sentinel
    container_name: origin-sentinel
    environment:
      - S3_ENDPOINT=https://s3.us-west-004.backblazeb2.com
      - S3_KEY=${B2_KEY_ID}
      - S3_SECRET=${B2_APP_KEY}
      - BACKUP_BUCKET=origin-os-backups
      - ALERT_OUTPUT_DIR=/vault/sentinel/alerts
    volumes:
      - sentinel-alerts:/vault/sentinel/alerts:rw
    depends_on:
      - vault
    restart: unless-stopped

  falkordb:
    image: falkordb/falkordb:latest
    container_name: origin-falkordb
    ports:
      - "6379:6379"
    volumes:
      - falkordb-data:/data
    restart: unless-stopped

volumes:
  mcp-data:
    name: origin-mcp-data
  vault-data:
    name: origin-vault-data
  orchestrator-data:
    name: origin-orchestrator-data
  backup-data:
    name: origin-backup-data
  memory-data:
    name: origin-memory-data
  sentinel-alerts:
    name: origin-sentinel-alerts
  codex-audit:
    name: origin-codex-audit
  codex-rules:
    name: origin-codex-rules
  system-state:
    name: origin-system-state
  auto-claude-data:
    name: origin-auto-claude-data
  auto-claude-worktrees:
    name: origin-auto-claude-worktrees
  falkordb-data:
    name: origin-falkordb-data
  figma-data:
    name: origin-figma-data
  vercel-data:
    name: origin-vercel-data

networks:
  default:
    name: origin-network
