{
  "annotations": {
    "list": []
  },
  "editable": true,
  "fiscalYearStartMonth": 0,
  "graphTooltip": 0,
  "id": null,
  "links": [],
  "liveNow": false,
  "panels": [
    {
      "title": "ðŸŽ¯ Surprise Heatmap",
      "description": "Distribution of surprise deltas by vertical. High surprise (red) indicates LAM hallucination.",
      "type": "heatmap",
      "gridPos": { "h": 8, "w": 12, "x": 0, "y": 0 },
      "datasource": { "type": "prometheus", "uid": "prometheus" },
      "targets": [
        {
          "expr": "sum(rate(lam_surprise_delta_bucket[5m])) by (le)",
          "format": "heatmap",
          "legendFormat": "{{le}}"
        }
      ],
      "options": {
        "calculate": false,
        "cellGap": 1,
        "color": {
          "exponent": 0.5,
          "fill": "dark-orange",
          "mode": "scheme",
          "reverse": true,
          "scale": "exponential",
          "scheme": "RdYlGn",
          "steps": 64
        },
        "yAxis": {
          "axisPlacement": "left",
          "reverse": false,
          "unit": "short"
        }
      }
    },
    {
      "title": "ðŸŒŠ Global Neural Drift",
      "description": "Centroid shift magnitude. >0.15 triggers FORCE_REEXPLORE.",
      "type": "gauge",
      "gridPos": { "h": 8, "w": 6, "x": 12, "y": 0 },
      "datasource": { "type": "prometheus", "uid": "prometheus" },
      "targets": [
        {
          "expr": "max(global_neural_drift_magnitude)",
          "legendFormat": "Drift Magnitude"
        }
      ],
      "options": {
        "orientation": "auto",
        "reduceOptions": {
          "calcs": ["lastNotNull"],
          "fields": "",
          "values": false
        },
        "showThresholdLabels": false,
        "showThresholdMarkers": true
      },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "thresholds" },
          "mappings": [],
          "max": 0.3,
          "min": 0,
          "thresholds": {
            "mode": "absolute",
            "steps": [
              { "color": "green", "value": null },
              { "color": "yellow", "value": 0.1 },
              { "color": "red", "value": 0.15 }
            ]
          },
          "unit": "short"
        }
      }
    },
    {
      "title": "âš¡ Router Latency (p99)",
      "description": "Decision latency by LoA level. >150ms triggers circuit breaker.",
      "type": "timeseries",
      "gridPos": { "h": 8, "w": 6, "x": 18, "y": 0 },
      "datasource": { "type": "prometheus", "uid": "prometheus" },
      "targets": [
        {
          "expr": "histogram_quantile(0.99, sum(rate(router_decision_latency_seconds_bucket[5m])) by (le, loa_level))",
          "legendFormat": "LoA {{loa_level}}"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "palette-classic" },
          "custom": {
            "axisCenteredZero": false,
            "axisColorMode": "text",
            "axisLabel": "",
            "axisPlacement": "auto",
            "barAlignment": 0,
            "drawStyle": "line",
            "fillOpacity": 10,
            "gradientMode": "none",
            "hideFrom": { "legend": false, "tooltip": false, "viz": false },
            "lineInterpolation": "linear",
            "lineWidth": 2,
            "pointSize": 5,
            "scaleDistribution": { "type": "linear" },
            "showPoints": "auto",
            "spanNulls": false,
            "stacking": { "group": "A", "mode": "none" },
            "thresholdsStyle": { "mode": "line" }
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              { "color": "green", "value": null },
              { "color": "red", "value": 0.15 }
            ]
          },
          "unit": "s"
        }
      }
    },
    {
      "title": "ðŸ“Š LAM Accuracy by Vertical",
      "description": "Offline replay accuracy. <70% blocks LoA promotion.",
      "type": "bargauge",
      "gridPos": { "h": 6, "w": 8, "x": 0, "y": 8 },
      "datasource": { "type": "prometheus", "uid": "prometheus" },
      "targets": [
        {
          "expr": "lam_offline_accuracy",
          "legendFormat": "{{vertical}}"
        }
      ],
      "options": {
        "displayMode": "gradient",
        "minVizHeight": 10,
        "minVizWidth": 0,
        "orientation": "horizontal",
        "reduceOptions": {
          "calcs": ["lastNotNull"],
          "fields": "",
          "values": false
        },
        "showUnfilled": true,
        "valueMode": "color"
      },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "thresholds" },
          "mappings": [],
          "max": 1,
          "min": 0,
          "thresholds": {
            "mode": "absolute",
            "steps": [
              { "color": "red", "value": null },
              { "color": "yellow", "value": 0.7 },
              { "color": "green", "value": 0.85 }
            ]
          },
          "unit": "percentunit"
        }
      }
    },
    {
      "title": "ðŸŽ›ï¸ Level of Autonomy",
      "description": "Current LoA level by vertical (1=Shadow, 4=Governor)",
      "type": "stat",
      "gridPos": { "h": 6, "w": 8, "x": 8, "y": 8 },
      "datasource": { "type": "prometheus", "uid": "prometheus" },
      "targets": [
        {
          "expr": "loa_current_level",
          "legendFormat": "{{vertical}}"
        }
      ],
      "options": {
        "colorMode": "value",
        "graphMode": "area",
        "justifyMode": "auto",
        "orientation": "auto",
        "reduceOptions": {
          "calcs": ["lastNotNull"],
          "fields": "",
          "values": false
        },
        "textMode": "auto"
      },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "thresholds" },
          "mappings": [
            { "options": { "1": { "text": "Shadow" } }, "type": "value" },
            { "options": { "2": { "text": "Advisory" } }, "type": "value" },
            { "options": { "3": { "text": "Co-Pilot" } }, "type": "value" },
            { "options": { "4": { "text": "Governor" } }, "type": "value" }
          ],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              { "color": "blue", "value": null },
              { "color": "yellow", "value": 2 },
              { "color": "orange", "value": 3 },
              { "color": "green", "value": 4 }
            ]
          }
        }
      }
    },
    {
      "title": "ðŸ“ˆ Thompson Sampling Reward Rate",
      "description": "Conversion rate by page variant",
      "type": "timeseries",
      "gridPos": { "h": 6, "w": 8, "x": 16, "y": 8 },
      "datasource": { "type": "prometheus", "uid": "prometheus" },
      "targets": [
        {
          "expr": "sum(rate(bandit_reward_total{outcome=\"conversion\"}[5m])) by (page_id) / sum(rate(bandit_reward_total[5m])) by (page_id)",
          "legendFormat": "{{page_id}}"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "palette-classic" },
          "custom": {
            "drawStyle": "line",
            "lineWidth": 2,
            "fillOpacity": 10
          },
          "unit": "percentunit"
        }
      }
    },
    {
      "title": "ðŸš¨ Circuit Breaker Events",
      "description": "Total circuit breaker trips by reason",
      "type": "timeseries",
      "gridPos": { "h": 6, "w": 12, "x": 0, "y": 14 },
      "datasource": { "type": "prometheus", "uid": "prometheus" },
      "targets": [
        {
          "expr": "increase(circuit_breaker_trips_total[1h])",
          "legendFormat": "{{vertical}} - {{reason}}"
        }
      ]
    },
    {
      "title": "ðŸŽ“ Curriculum Stage Progress",
      "description": "Current curriculum training stage by vertical",
      "type": "stat",
      "gridPos": { "h": 6, "w": 6, "x": 12, "y": 14 },
      "datasource": { "type": "prometheus", "uid": "prometheus" },
      "targets": [
        {
          "expr": "curriculum_stage_current",
          "legendFormat": "{{vertical}}"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "thresholds" },
          "mappings": [
            { "options": { "1": { "text": "Stage 1: High Signal" } }, "type": "value" },
            { "options": { "2": { "text": "Stage 2: Failures" } }, "type": "value" },
            { "options": { "3": { "text": "Stage 3: Marginal" } }, "type": "value" },
            { "options": { "4": { "text": "Stage 4: Noisy" } }, "type": "value" }
          ],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              { "color": "green", "value": null },
              { "color": "yellow", "value": 2 },
              { "color": "orange", "value": 3 },
              { "color": "red", "value": 4 }
            ]
          }
        }
      }
    },
    {
      "title": "âš ï¸ Dark Pattern Detections",
      "description": "Dark patterns detected and blocked",
      "type": "piechart",
      "gridPos": { "h": 6, "w": 6, "x": 18, "y": 14 },
      "datasource": { "type": "prometheus", "uid": "prometheus" },
      "targets": [
        {
          "expr": "sum(increase(dark_pattern_detections_total[24h])) by (pattern_type)",
          "legendFormat": "{{pattern_type}}"
        }
      ]
    },
    {
      "title": "ðŸ­ Container Lifecycle",
      "description": "Container spawns and tombstones over time",
      "type": "timeseries",
      "gridPos": { "h": 6, "w": 12, "x": 0, "y": 20 },
      "datasource": { "type": "prometheus", "uid": "prometheus" },
      "targets": [
        {
          "expr": "sum(rate(container_spawns_total[5m])) by (vertical)",
          "legendFormat": "Spawns - {{vertical}}"
        },
        {
          "expr": "sum(rate(container_tombstones_total[5m])) by (vertical)",
          "legendFormat": "Tombstones - {{vertical}}"
        }
      ]
    },
    {
      "title": "ðŸ“‰ Training Loss",
      "description": "Current training loss by vertical and stage",
      "type": "timeseries",
      "gridPos": { "h": 6, "w": 12, "x": 12, "y": 20 },
      "datasource": { "type": "prometheus", "uid": "prometheus" },
      "targets": [
        {
          "expr": "training_loss",
          "legendFormat": "{{vertical}} - Stage {{stage}}"
        }
      ]
    }
  ],
  "refresh": "30s",
  "schemaVersion": 38,
  "style": "dark",
  "tags": ["ad-engine", "lam", "autonomic"],
  "templating": {
    "list": [
      {
        "current": { "selected": false, "text": "All", "value": "$__all" },
        "datasource": { "type": "prometheus", "uid": "prometheus" },
        "definition": "label_values(lam_surprise_delta, vertical)",
        "name": "vertical",
        "options": [],
        "query": { "query": "label_values(lam_surprise_delta, vertical)", "refId": "A" },
        "type": "query",
        "includeAll": true,
        "multi": true
      }
    ]
  },
  "time": { "from": "now-1h", "to": "now" },
  "timepicker": {},
  "timezone": "",
  "title": "Autonomic Ad-Engine Dashboard",
  "uid": "ad-engine-main",
  "version": 1,
  "weekStart": ""
}
